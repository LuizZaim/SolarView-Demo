{% extends "base.html" %}
{% block title %}SolarView Dashboard{% endblock %}
{% block extra_css %}
    <style>
        /* Estilos aprimorados para o dashboard */
        .mobile-optimized {
            font-size: 16px; /* Previne zoom autom√°tico em iOS */
        }
        .chart-container {
            min-height: 400px;
            transition: all 0.3s ease;
        }
        /* Estilos para elementos focados (acessibilidade) */
        .focused {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        /* Responsividade para mobile */
        @media (max-width: 768px) {
            .chart-container {
                min-height: 300px;
            }
            #kpi-container {
                grid-template-columns: 1fr;
            }
            .text-3xl {
                font-size: 1.875rem;
            }
            .p-4 {
                padding: 1rem;
            }
            .p-8 {
                padding: 1rem;
            }
        }
        /* Modo de alto contraste */
        .high-contrast {
            background-color: #000000;
            color: #ffffff;
        }
        .high-contrast .bg-white {
            background-color: #000000 !important;
            border: 2px solid #ffffff;
        }
        .high-contrast .text-gray-800 {
            color: #ffffff !important;
        }
        .high-contrast .bg-amber-400 {
            background-color: #ffff00 !important;
        }
        .high-contrast .text-white {
            color: #000000 !important;
        }
        /* Bot√µes com foco */
        button:focus, input:focus, select:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        /* Estados de loading */
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        /* Transi√ß√µes suaves */
        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }
        .transform {
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));
        }
        .scale-105 {
            --tw-scale-x: 1.05;
            --tw-scale-y: 1.05;
        }
        .hover\:scale-105:hover {
            --tw-scale-x: 1.05;
            --tw-scale-y: 1.05;
        }
        /* Cores escuras */
        .dark .bg-white {
            background-color: #1e293b;
        }
        .dark .text-gray-800 {
            color: #f1f5f9;
        }
        .dark .text-gray-500 {
            color: #94a3b8;
        }
        .dark .border-gray-300 {
            border-color: #475569;
        }
        .dark .bg-gray-100 {
            background-color: #334155;
        }
        /* Bot√£o de fechar para a an√°lise da IA */
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        .close-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        .dark .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        /* Notifica√ß√µes */
        .notification {
            max-width: 380px;
            min-width: 320px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease-in-out;
        }
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        .notification.hide {
            transform: translateX(100%);
            opacity: 0;
        }
        .notification-success {
            border-left: 4px solid #10B981;
        }
        .notification-warning {
            border-left: 4px solid #F59E0B;
        }
        .notification-error {
            border-left: 4px solid #EF4444;
        }
        .notification-info {
            border-left: 4px solid #3B82F6;
        }
        .notification-icon-success { color: #10B981; }
        .notification-icon-warning { color: #F59E0B; }
        .notification-icon-error { color: #EF4444; }
        .notification-icon-info { color: #3B82F6; }
        .dark .notification-success {
            background-color: #064E3B;
            border-color: #10B981;
        }
        .dark .notification-warning {
            background-color: #78350F;
            border-color: #F59E0B;
        }
        .dark .notification-error {
            background-color: #7F1D1D;
            border-color: #EF4444;
        }
        .dark .notification-info {
            background-color: #1E3A8A;
            border-color: #3B82F6;
        }
        /* Ajustes espec√≠ficos para a navega√ß√£o em mobile */
        @media (max-width: 768px) {
            header .container {
                flex-direction: column;
                align-items: flex-start;
            }
            header nav {
                width: 100%;
                flex-direction: column;
                gap: 0.5rem;
                margin-top: 1rem;
                align-items: flex-start;
            }
            header nav a {
                width: 100%;
                text-align: center;
            }
            header .flex-grow {
                display: none;
            }
        }
        /* ‚úÖ Estilo para o texto da an√°lise da IA */
        #ai-analysis-text {
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
            font-size: 1rem;
        }
        /* ‚úÖ Estilos para simular o app eWeLink */
        .ewelink-simulation {
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: #f8fafc;
            margin-top: 1rem;
            font-size: 0.875rem;
        }
        .ewelink-simulation.dark {
            background-color: #1e293b;
            border-color: #334155;
        }
        .ewelink-device-name {
            font-weight: 600;
            color: #1e40af;
        }
        .ewelink-status-on {
            color: #059669;
            font-weight: bold;
        }
        .ewelink-status-off {
            color: #dc2626;
        }
        .ewelink-timestamp {
            color: #64748b;
            font-size: 0.75rem;
        }
        .ewelink-icon {
            width: 20px;
            height: 20px;
            vertical-align: middle;
            margin-right: 6px;
        }
        .solar-automation-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
        }
        .solar-automation-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.4);
        }
        .solar-automation-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
    </style>
{% endblock %}
{% block content %}
    <header class="bg-white dark:bg-slate-800 shadow-sm sticky top-0 z-10">
        <div class="container mx-auto p-4 flex flex-wrap justify-between items-center">
            <a href="/dashboard" class="flex items-center gap-2 mb-2 sm:mb-0">
                <div class="w-8 h-8 bg-amber-400 rounded-full flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                        </path>
                    </svg>
                </div>
                <h1 class="text-xl font-bold text-gray-800 dark:text-gray-100">SolarView</h1>
            </a>
            <nav class="flex flex-wrap gap-4 items-center">
                <a href="/dashboard" class="px-4 py-2 bg-amber-500 text-white font-semibold rounded-lg hover:bg-amber-600 text-sm transition-colors duration-300">
                    Dashboard
                </a>
                <a href="/previsao" class="px-4 py-2 bg-amber-500 text-white font-semibold rounded-lg hover:bg-amber-600 text-sm transition-colors duration-300">
                    üìä Previs√£o Solar
                </a>
                <a href="/water-control" class="px-4 py-2 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-800 text-sm transition-colors duration-300">
                    ‚öôÔ∏è Controle de Equipamentos
                </a>
                <a href="/settings" class="px-4 py-2 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-800 text-sm transition-colors duration-300">
                    ‚öôÔ∏è Configura√ß√µes
                </a>
            </nav>
            <div class="flex items-center gap-4">
                <a href="/logout"
                   class="px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 text-sm transition-colors duration-300">
                    Sair
                </a>
            </div>
        </div>
    </header>
    <main class="container mx-auto p-4 md:p-8">
        <div class="text-center mb-8">
            <h2 id="dashboard-title" class="text-3xl font-bold text-gray-800 dark:text-gray-100">Dashboard de An√°lise</h2>
            <p id="status-text" class="text-gray-500 dark:text-gray-400 mt-2">An√°lise de performance energ√©tica</p>
        </div>
        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-lg mb-6">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center gap-2">
                    <h3 class="font-semibold text-gray-700 dark:text-gray-200">Favoritos:</h3>
                    <div id="favorites-container" class="flex flex-wrap gap-2">
                        </div>
                </div>
                <button id="add-favorite-btn"
                        class="px-3 py-1 bg-amber-500 text-white text-sm rounded-lg hover:bg-amber-600 transition-colors">
                    ‚òÖ Adicionar Favorito
                </button>
            </div>
            <div class="mt-4">
                <h3 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">Hist√≥rico Recente:</h3>
                <div id="history-container" class="flex flex-wrap gap-2">
                    </div>
            </div>
        </div>
        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-lg mb-8 flex flex-wrap justify-center items-center gap-4">
            <label for="datePicker" class="font-semibold text-gray-700 dark:text-gray-200">Selecione uma </label>
            <input type="date" id="datePicker" class="border-gray-300 dark:border-gray-600 dark:bg-slate-700 dark:text-gray-200 rounded-lg shadow-sm">
            <button id="fetchDataBtn"
                    class="px-5 py-2.5 bg-amber-500 text-white font-semibold rounded-lg hover:bg-amber-600 flex items-center justify-center transition-all duration-300 transform hover:scale-105">
                <span id="button-text">Analisar Dia</span>
                <svg id="button-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden"
                     xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                </svg>
            </button>
        </div>
        <div id="kpi-container" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"></div>
        <div id="ai-section" class="mb-8 hidden">
            <button id="analyzeBtn"
                    class="w-full px-4 py-2 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-800 flex items-center justify-center gap-2 transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                          d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"
                          clip-rule="evenodd" />
                </svg>
                <span id="ai-button-text">Analisar com IA</span>
                <svg id="ai-button-spinner" class="animate-spin h-5 w-5 text-white hidden"
                     xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                </svg>
            </button>
            <div id="ai-analysis-container" class="mt-4 bg-white dark:bg-slate-800 p-6 rounded-xl shadow-lg hidden relative">
                <button id="close-ai-btn" class="close-btn text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
                <h3 id="ai-title" class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-2">An√°lise Inteligente do Dia</h3>
                <p id="ai-analysis-text" class="text-gray-600 dark:text-gray-300"></p>
                <div id="comparison-chart" class="mt-4 chart-container"></div>
                <div id="ai-recommendations-container" class="mt-4 space-y-2"></div>
                <!-- ‚úÖ SE√á√ÉO DE AUTOMA√á√ÉO INTELIGENTE (SIMULA√á√ÉO eWeLink) -->
                <div id="automation-section" class="hidden mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <h4 class="font-semibold text-gray-700 dark:text-gray-200 mb-3">‚ö° Automa√ß√£o com eWeLink</h4>
                    <button id="trigger-ewelink-btn" class="solar-automation-btn">
                        <svg class="ewelink-icon" viewBox="0 0 24 24" fill="#fff">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        Ligar M√°quina de Lavar
                    </button>
                    <p id="ewelink-status" class="mt-2 text-sm text-gray-500 dark:text-gray-400 min-h-[1.25rem]"></p>
                    <div id="ewelink-log" class="ewelink-simulation mt-3 hidden">
                        <div class="flex justify-between">
                            <span class="ewelink-device-name">M√°quina de Lavar ‚Äì Sala de Servi√ßo</span>
                            <span id="log-status" class="ewelink-status-off">Desligado</span>
                        </div>
                        <div id="log-timestamp" class="ewelink-timestamp mt-1">‚Äî</div>
                    </div>
                </div>
            </div>
        </div>
        <div id="charts-container" class="space-y-8"></div>
    </main>
    <div id="notifications-container" class="fixed top-20 right-4 z-50 space-y-2"></div>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <script>
        // C√≥digo JavaScript aprimorado
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM carregado!');
            // Definir data atual
            const datePicker = document.getElementById('datePicker');
            if (datePicker) {
                datePicker.value = new Date().toISOString().split('T')[0];
                console.log('Data definida:', datePicker.value);
            }
            // Adicionar evento ao bot√£o de an√°lise
            const fetchDataBtn = document.getElementById('fetchDataBtn');
            if (fetchDataBtn) {
                fetchDataBtn.addEventListener('click', fetchDashboardData);
                console.log('Evento adicionado ao bot√£o Analisar Dia');
            } else {
                console.error('Bot√£o Analisar Dia n√£o encontrado!');
            }
            // Adicionar evento ao bot√£o de IA
            const analyzeBtn = document.getElementById('analyzeBtn');
            if (analyzeBtn) {
                analyzeBtn.addEventListener('click', handleAiAnalysis);
                console.log('Evento adicionado ao bot√£o Analisar com IA');
            }
            // Adicionar evento ao bot√£o de fechar an√°lise da IA
            const closeAiBtn = document.getElementById('close-ai-btn');
            if (closeAiBtn) {
                closeAiBtn.addEventListener('click', closeAiAnalysis);
                console.log('Evento adicionado ao bot√£o Fechar An√°lise IA');
            }
            // Adicionar evento ao bot√£o de favoritos
            const addFavoriteBtn = document.getElementById('add-favorite-btn');
            if (addFavoriteBtn) {
                addFavoriteBtn.addEventListener('click', addCurrentDateToFavorites);
                console.log('Evento adicionado ao bot√£o Adicionar Favorito');
            }
            // Carregar favoritos e hist√≥rico
            loadFavorites();
            loadHistory();
            // Mostrar notifica√ß√£o de boas-vindas
            setTimeout(() => {
                showInfoNotification(
                    'Bem-vindo ao SolarView!',
                    'Sistema de monitoramento de energia solar ativado.',
                    4000
                );
            }, 1000);
        });
        let currentData = null;
        async function fetchDashboardData() {
            console.log('Fun√ß√£o fetchDashboardData chamada!');
            const datePicker = document.getElementById('datePicker');
            const selectedDate = datePicker ? datePicker.value : new Date().toISOString().split('T')[0];
            console.log('Data selecionada:', selectedDate);
            if (!selectedDate) {
                alert('Por favor, selecione uma data!');
                return;
            }
            // Mostrar estado de carregamento
            showLoadingState(true);
            showSkeletons();
            try {
                console.log('Fazendo requisi√ß√£o para /api/data?date=' + selectedDate);
                const response = await fetch(`/api/data?date=${selectedDate}`);
                console.log('Status da resposta:', response.status);
                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Erro na resposta:', errorText);
                    throw new Error(`Erro ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                console.log('Dados recebidos:', data);
                currentData = data;
                renderDashboard(data);
                // Mostrar notifica√ß√£o de sucesso
                showSuccessNotification(
                    'Dados Carregados',
                    'Os dados do dia foram carregados com sucesso!',
                    3000
                );
                // Verificar notifica√ß√µes autom√°ticas
                checkAutomaticNotifications(data.kpis);
            } catch (error) {
                console.error('Erro ao buscar dados:', error);
                showError(error.message);
                // Mostrar notifica√ß√£o de erro
                showErrorNotification(
                    'Erro ao Carregar Dados',
                    'N√£o foi poss√≠vel carregar os dados. Tente novamente.',
                    5000
                );
            } finally {
                showLoadingState(false);
            }
        }
        function showLoadingState(isLoading) {
            const buttonText = document.getElementById('button-text');
            const buttonSpinner = document.getElementById('button-spinner');
            const fetchDataBtn = document.getElementById('fetchDataBtn');
            if (buttonText && buttonSpinner && fetchDataBtn) {
                if (isLoading) {
                    buttonText.classList.add('hidden');
                    buttonSpinner.classList.remove('hidden');
                    fetchDataBtn.disabled = true;
                } else {
                    buttonText.classList.remove('hidden');
                    buttonSpinner.classList.add('hidden');
                    fetchDataBtn.disabled = false;
                }
            }
        }
        function showSkeletons() {
            const kpiContainer = document.getElementById('kpi-container');
            const chartsContainer = document.getElementById('charts-container');
            if (kpiContainer) {
                kpiContainer.innerHTML = `
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg animate-pulse">
                        <div class="h-6 bg-gray-200 dark:bg-slate-700 rounded w-3/4"></div>
                        <div class="h-8 bg-gray-300 dark:bg-slate-600 rounded w-1/2 mt-2"></div>
                    </div>`.repeat(3);
            }
            if (chartsContainer) {
                chartsContainer.innerHTML = `
                    <div class="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-lg animate-pulse chart-container"></div>
                    <div class="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-lg animate-pulse chart-container"></div>`;
            }
        }
        function renderDashboard(data) {
            renderKPIs(data.kpis);
            renderCharts(data.charts);
            updateStatusText();
            // Mostrar se√ß√£o de IA
            const aiSection = document.getElementById('ai-section');
            if (aiSection) {
                aiSection.classList.remove('hidden');
            }
            // Esconder a an√°lise da IA quando carregar novos dados
            hideAiAnalysis();
        }
        function hideAiAnalysis() {
            // Esconder o container de an√°lise da IA
            const aiAnalysisContainer = document.getElementById('ai-analysis-container');
            if (aiAnalysisContainer) {
                aiAnalysisContainer.classList.add('hidden');
            }
            // Resetar o texto do bot√£o de IA
            const aiButtonText = document.getElementById('ai-button-text');
            const aiButtonSpinner = document.getElementById('ai-button-spinner');
            if (aiButtonText && aiButtonSpinner) {
                aiButtonText.classList.remove('hidden');
                aiButtonSpinner.classList.add('hidden');
                aiButtonText.textContent = 'Analisar com IA';
            }
        }
        function closeAiAnalysis() {
            // Esconder o container de an√°lise da IA
            const aiAnalysisContainer = document.getElementById('ai-analysis-container');
            if (aiAnalysisContainer) {
                aiAnalysisContainer.classList.add('hidden');
            }
            // Resetar o texto do bot√£o de IA
            const aiButtonText = document.getElementById('ai-button-text');
            const aiButtonSpinner = document.getElementById('ai-button-spinner');
            if (aiButtonText && aiButtonSpinner) {
                aiButtonText.classList.remove('hidden');
                aiButtonSpinner.classList.add('hidden');
                aiButtonText.textContent = 'Analisar com IA';
            }
        }
        function renderKPIs(kpis) {
            const kpiContainer = document.getElementById('kpi-container');
            if (!kpiContainer) return;
            kpiContainer.innerHTML = '';
            // KPI de Energia Total
            const energyKpi = createKpiCard(
                "Energia Total",
                `${kpis.total_energy} kWh`,
                '<svg class="w-8 h-8 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>'
            );
            // KPI de Pico Solar
            const peakKpi = createKpiCard(
                "Pico Solar",
                `${kpis.peak_power} W`,
                '<svg class="w-8 h-8 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>'
            );
            // KPI de Bateria
            const socChange = kpis.soc_initial !== null ?
                `${kpis.soc_initial}% ‚Üí ${kpis.soc_final}%` : 'N/D';
            const batteryKpi = createKpiCard(
                "Bateria",
                socChange,
                '<svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 10a1 1 0 11-2 0 1 1 0 012 0z"></path></svg>'
            );
            kpiContainer.innerHTML = energyKpi + peakKpi + batteryKpi;
        }
        function createKpiCard(title, value, iconSvg) {
            return `
                <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg flex items-center transition-transform transform hover:scale-105">
                    <div class="bg-amber-100 dark:bg-slate-700 p-3 rounded-full mr-4">
                        ${iconSvg}
                    </div>
                    <div>
                        <p class="text-gray-500 dark:text-gray-400 font-semibold">${title}</p>
                        <p class="text-2xl font-bold text-gray-800 dark:text-gray-100">${value}</p>
                    </div>
                </div>
            `;
        }
        function renderCharts(charts) {
            const chartsContainer = document.getElementById('charts-container');
            if (!chartsContainer) return;
            chartsContainer.innerHTML = '';
            // Gr√°fico de Fluxo de Pot√™ncia
            const powerChartDiv = document.createElement('div');
            powerChartDiv.id = 'power-chart';
            powerChartDiv.className = 'bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-lg chart-container';
            chartsContainer.appendChild(powerChartDiv);
            createPowerChart(powerChartDiv, charts);
            // Verificar se existem dados da bateria e renderizar o gr√°fico
            if (charts.series.Cbattery1 && charts.series.Cbattery1.length > 0) {
                const batteryChartDiv = document.createElement('div');
                batteryChartDiv.id = 'battery-chart';
                batteryChartDiv.className = 'bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-lg chart-container mt-6';
                chartsContainer.appendChild(batteryChartDiv);
                createBatteryChart(batteryChartDiv, charts);
            }
        }
        function createPowerChart(container, charts) {
            const isDarkMode = document.documentElement.classList.contains('dark');
            const fontColor = isDarkMode ? '#E5E7EB' : '#1F2937';
            const paperColor = isDarkMode ? '#1e293b' : '#ffffff';
            const gridColor = isDarkMode ? '#475569' : '#E5E7EB';
            const traceSolar = {
                x: charts.timestamps,
                y: charts.series.Pac,
                mode: 'lines',
                name: 'Gera√ß√£o Solar (W)',
                line: { color: '#FBBF24', width: 3 },
                fill: 'tozeroy',
                fillcolor: 'rgba(251, 191, 36, 0.1)'
            };
            const traceGrid = {
                x: charts.timestamps,
                y: charts.series.pgrid,
                mode: 'lines',
                name: 'Rede (W)',
                line: { color: '#EF4444', dash: 'dot' }
            };
            const layout = {
                title: {
                    text: '<b>Fluxo de Pot√™ncia</b>',
                    font: { color: fontColor }
                },
                xaxis: {
                    title: 'Hora do Dia',
                    color: fontColor,
                    gridcolor: gridColor
                },
                yaxis: {
                    title: 'Pot√™ncia (W)',
                    color: fontColor,
                    gridcolor: gridColor
                },
                legend: {
                    x: 0.01,
                    y: 0.98,
                    font: { color: fontColor }
                },
                paper_bgcolor: paperColor,
                plot_bgcolor: paperColor,
                margin: { t: 50, b: 50, l: 60, r: 20 }
            };
            Plotly.newPlot(container, [traceSolar, traceGrid], layout, { responsive: true });
        }
        function createBatteryChart(container, charts) {
            const isDarkMode = document.documentElement.classList.contains('dark');
            const fontColor = isDarkMode ? '#E5E7EB' : '#1F2937';
            const paperColor = isDarkMode ? '#1e293b' : '#ffffff';
            const gridColor = isDarkMode ? '#475569' : '#E5E7EB';
            const traceBattery = {
                x: charts.timestamps,
                y: charts.series.Cbattery1,
                mode: 'lines',
                name: 'Estado da Bateria (%)',
                line: { color: '#22C55E', width: 3 },
                fill: 'tozeroy',
                fillcolor: 'rgba(34, 197, 94, 0.1)'
            };
            const layout = {
                title: {
                    text: '<b>Estado de Carga da Bateria (SOC)</b>',
                    font: { color: fontColor }
                },
                xaxis: {
                    title: 'Hora do Dia',
                    color: fontColor,
                    gridcolor: gridColor
                },
                yaxis: {
                    title: 'Carga (%)',
                    range: [0, 100],
                    color: fontColor,
                    gridcolor: gridColor
                },
                legend: {
                    x: 0.01,
                    y: 0.98,
                    font: { color: fontColor }
                },
                paper_bgcolor: paperColor,
                plot_bgcolor: paperColor,
                margin: { t: 50, b: 50, l: 60, r: 20 }
            };
            Plotly.newPlot(container, [traceBattery], layout, { responsive: true });
        }
        async function handleAiAnalysis() {
            if (!currentData) {
                alert('Por favor, analise os dados primeiro!');
                return;
            }
            const aiButtonText = document.getElementById('ai-button-text');
            const aiButtonSpinner = document.getElementById('ai-button-spinner');
            const aiAnalysisContainer = document.getElementById('ai-analysis-container');
            const aiAnalysisText = document.getElementById('ai-analysis-text');
            const aiRecommendationsContainer = document.getElementById('ai-recommendations-container');
            const datePicker = document.getElementById('datePicker');
            const selectedDate = datePicker.value;
            if (!aiButtonText || !aiButtonSpinner || !aiAnalysisContainer || !aiAnalysisText || !aiRecommendationsContainer) return;
            // Mostrar estado de carregamento
            aiButtonText.classList.add('hidden');
            aiButtonSpinner.classList.remove('hidden');
            aiAnalysisContainer.classList.remove('hidden');
            aiAnalysisText.textContent = 'A nossa IA est√° a pensar...';
            aiRecommendationsContainer.innerHTML = ''; // Limpar recomenda√ß√µes antigas
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ kpis: currentData.kpis, date: selectedDate })
                });
                if (!response.ok) {
                    throw new Error('Erro na an√°lise de IA');
                }
                const data = await response.json();
                aiAnalysisText.textContent = data.analysis;
                // Chamar a fun√ß√£o para criar o gr√°fico
                createComparisonChart(data.chart_data);
                // Renderizar as recomenda√ß√µes
                renderRecommendations(data.recomendacoes);
                // Mostrar notifica√ß√£o de sucesso
                showSuccessNotification(
                    'An√°lise Conclu√≠da',
                    'A an√°lise da IA foi gerada com sucesso!',
                    3000
                );
            } catch (error) {
                console.error('Erro na an√°lise de IA:', error);
                aiAnalysisText.textContent = 'Erro ao gerar an√°lise.';
                // Mostrar notifica√ß√£o de erro
                showErrorNotification(
                    'Erro na An√°lise',
                    'N√£o foi poss√≠vel gerar a an√°lise da IA. Tente novamente.',
                    5000
                );
            } finally {
                aiButtonText.classList.remove('hidden');
                aiButtonSpinner.classList.add('hidden');
            }
        }
        // NOVA FUN√á√ÉO PARA CRIAR O GR√ÅFICO DE COMPARA√á√ÉO
        function createComparisonChart(chartData) {
            const container = document.getElementById('comparison-chart');
            if (!container) return;
            const isDarkMode = document.documentElement.classList.contains('dark');
            const fontColor = isDarkMode ? '#E5E7EB' : '#1F2937';
            const paperColor = isDarkMode ? '#1e293b' : '#ffffff';
            const gridColor = isDarkMode ? '#475569' : '#E5E7EB';
            const trace = {
                x: chartData.labels,
                y: chartData.values,
                type: 'bar',
                marker: {
                    color: ['#FBBF24', '#94a3b8']
                },
                hovertemplate: '<b>%{x}</b>: %{y} kWh<extra></extra>'
            };
            const layout = {
                title: {
                    text: '<b>Compara√ß√£o de Energia Total</b>',
                    font: { color: fontColor }
                },
                xaxis: {
                    title: 'Per√≠odo',
                    color: fontColor,
                    gridcolor: gridColor
                },
                yaxis: {
                    title: 'Energia (kWh)',
                    color: fontColor,
                    gridcolor: gridColor
                },
                paper_bgcolor: paperColor,
                plot_bgcolor: paperColor,
                margin: { t: 50, b: 50, l: 60, r: 20 }
            };
            Plotly.newPlot(container, [trace], layout, { responsive: true });
        }
        // ‚úÖ FUN√á√ÉO ATUALIZADA PARA RENDERIZAR RECOMENDA√á√ïES E MOSTRAR BOT√ÉO
        function renderRecommendations(recommendations) {
            const container = document.getElementById('ai-recommendations-container');
            const automationSection = document.getElementById('automation-section');
            if (!container || !automationSection) return;

            // Verifica se alguma recomenda√ß√£o menciona aparelhos pesados, ensolarado, etc.
            const showAutomation = recommendations.some(rec =>
                /m√°quina|aparelhos pesados|10h|ensolarado|entre 10h e 15h/i.test(rec)
            );
            automationSection.classList.toggle('hidden', !showAutomation);

            if (recommendations.length === 0) {
                container.innerHTML = `<p class="text-gray-500 dark:text-gray-400">Nenhuma recomenda√ß√£o adicional para este dia.</p>`;
                return;
            }
            container.innerHTML = recommendations.map(rec => `
                <div class="flex items-start p-4 rounded-lg bg-gray-100 dark:bg-slate-700">
                    <div class="flex-shrink-0 w-6 h-6 text-green-500 dark:text-green-400">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <p class="ml-3 text-gray-700 dark:text-gray-300 text-sm">${rec}</p>
                </div>
            `).join('');
        }
        function updateStatusText() {
            const statusText = document.getElementById('status-text');
            const datePicker = document.getElementById('datePicker');
            if (statusText && datePicker) {
                const selectedDate = datePicker.value;
                statusText.textContent = `An√°lise de performance energ√©tica para ${selectedDate}`;
            }
        }
        function showError(message) {
            const kpiContainer = document.getElementById('kpi-container');
            const chartsContainer = document.getElementById('charts-container');
            if (kpiContainer) {
                kpiContainer.innerHTML = `
                    <div class="col-span-full bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-100 px-4 py-3 rounded-lg">
                        <p><strong>Erro:</strong> ${message}</p>
                    </div>
                `;
            }
            if (chartsContainer) {
                chartsContainer.innerHTML = '';
            }
        }
        // --- Fun√ß√µes de Favoritos e Hist√≥rico ---
        // Carregar favoritos do servidor
        async function loadFavorites() {
            try {
                const response = await fetch('/api/favorites');
                if (response.ok) {
                    const favorites = await response.json();
                    renderFavorites(favorites);
                }
            } catch (error) {
                console.error('Erro ao carregar favoritos:', error);
            }
        }
        // Carregar hist√≥rico do servidor
        async function loadHistory() {
            try {
                const response = await fetch('/api/history');
                if (response.ok) {
                    const history = await response.json();
                    renderHistory(history);
                }
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
            }
        }
        // Renderizar favoritos na interface
        function renderFavorites(favorites) {
            const container = document.getElementById('favorites-container');
            if (!container) return;
            if (favorites.length === 0) {
                container.innerHTML = '<span class="text-gray-400 text-sm">Nenhum favorito ainda</span>';
                return;
            }
            container.innerHTML = favorites.map(date => `
                <div class="flex items-center bg-amber-100 dark:bg-slate-700 px-2 py-1 rounded-lg">
                    <button onclick="loadFavoriteDate('${date}')"
                            class="text-amber-800 dark:text-amber-200 hover:underline text-sm">
                        ${formatDateDisplay(date)}
                    </button>
                    <button onclick="removeFavorite('${date}')"
                            class="ml-1 text-amber-600 dark:text-amber-400 hover:text-amber-800 dark:hover:text-amber-200">
                        √ó
                    </button>
                </div>
            `).join('');
        }
        // Renderizar hist√≥rico na interface
        function renderHistory(history) {
            const container = document.getElementById('history-container');
            if (!container) return;
            if (history.length === 0) {
                container.innerHTML = '<span class="text-gray-400 text-sm">Nenhum hist√≥rico ainda</span>';
                return;
            }
            container.innerHTML = history.reverse().map(date => `
                <button onclick="loadFavoriteDate('${date}')"
                        class="px-2 py-1 bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-300 text-sm rounded hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors">
                    ${formatDateDisplay(date)}
                </button>
            `).join('');
        }
        // Formatar data para exibi√ß√£o
        function formatDateDisplay(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            if (date.toDateString() === today.toDateString()) {
                return 'Hoje';
            } else if (date.toDateString() === yesterday.toDateString()) {
                return 'Ontem';
            } else {
                return date.toLocaleDateString('pt-BR');
            }
        }
        // Adicionar data atual aos favoritos
        async function addCurrentDateToFavorites() {
            const datePicker = document.getElementById('datePicker');
            if (!datePicker) return;
            const currentDate = datePicker.value;
            if (!currentDate) {
                alert('Por favor, selecione uma data primeiro!');
                return;
            }
            try {
                const response = await fetch('/api/favorites', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date: currentDate })
                });
                if (response.ok) {
                    const data = await response.json();
                    renderFavorites(data.favorites);
                    alert('Adicionado aos favoritos!');
                } else {
                    const error = await response.json();
                    alert('Erro: ' + error.error);
                }
            } catch (error) {
                console.error('Erro ao adicionar favorito:', error);
                alert('Erro ao adicionar aos favoritos');
            }
        }
        // Remover favorito
        async function removeFavorite(date) {
            try {
                const response = await fetch(`/api/favorites/${date}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    const data = await response.json();
                    renderFavorites(data.favorites);
                }
            } catch (error) {
                console.error('Erro ao remover favorito:', error);
            }
        }
        // Carregar data favorita
        function loadFavoriteDate(date) {
            const datePicker = document.getElementById('datePicker');
            if (datePicker) {
                datePicker.value = date;
                // Simular clique no bot√£o de an√°lise
                const fetchDataBtn = document.getElementById('fetchDataBtn');
                if (fetchDataBtn) {
                    fetchDataBtn.click();
                }
            }
        }
        // ‚úÖ SIMULA√á√ÉO REALISTA DE INTEGRA√á√ÉO COM eWeLink
        document.getElementById('trigger-ewelink-btn')?.addEventListener('click', function() {
            const statusEl = document.getElementById('ewelink-status');
            const logEl = document.getElementById('ewelink-log');
            const logStatus = document.getElementById('log-status');
            const logTimestamp = document.getElementById('log-timestamp');
            const btn = this;

            // Ativar log
            logEl.classList.remove('hidden');

            // Etapa 1: Conectando
            btn.disabled = true;
            statusEl.textContent = 'Conectando ao eWeLink...';
            logStatus.textContent = 'Conectando...';
            logStatus.className = 'ewelink-timestamp';

            setTimeout(() => {
                // Etapa 2: Enviando comando
                statusEl.textContent = 'Enviando comando para o dispositivo...';
                logStatus.textContent = 'Comando enviado';
                logStatus.className = 'text-yellow-600 dark:text-yellow-400';

                setTimeout(() => {
                    // Etapa 3: Sucesso!
                    const now = new Date().toLocaleTimeString('pt-BR');
                    statusEl.innerHTML = '‚úÖ <strong>Dispositivo ligado com sucesso!</strong>';
                    statusEl.className = 'mt-2 text-sm text-green-600 dark:text-green-400';
                    logStatus.textContent = 'Ligado';
                    logStatus.className = 'ewelink-status-on';
                    logTimestamp.textContent = `Ligado √†s ${now}`;

                    showSuccessNotification(
                        'Automa√ß√£o Ativada!',
                        'M√°quina de lavar ligada usando energia solar gratuita!'
                    );

                    // Reativar bot√£o ap√≥s 4s
                    setTimeout(() => {
                        btn.disabled = false;
                    }, 4000);
                }, 1200);
            }, 800);
        });
        // --- Sistema de Notifica√ß√µes ---
        /**
         * Mostra uma notifica√ß√£o para o usu√°rio
         * @param {string} type - Tipo da notifica√ß√£o: 'success', 'warning', 'error', 'info'
         * @param {string} title - T√≠tulo da notifica√ß√£o
         * @param {string} message - Mensagem da notifica√ß√£o
         * @param {number} duration - Dura√ß√£o em milissegundos (0 para permanente)
         */
        function showNotification(type, title, message, duration = 5000) {
            const container = document.getElementById('notifications-container');
            if (!container) return;
            // Criar ID √∫nico para a notifica√ß√£o
            const notificationId = 'notification-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            // Criar elemento da notifica√ß√£o
            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `notification notification-${type} bg-white dark:bg-slate-800 rounded-lg shadow-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden`;
            // √çcone baseado no tipo
            let iconHtml = '';
            switch(type) {
                case 'success':
                    iconHtml = '<svg class="h-6 w-6 text-green-500 dark:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
                    break;
                case 'warning':
                    iconHtml = '<svg class="h-6 w-6 text-yellow-500 dark:text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
                    break;
                case 'error':
                    iconHtml = '<svg class="h-6 w-6 text-red-500 dark:text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
                    break;
                default: // info
                    iconHtml = '<svg class="h-6 w-6 text-blue-500 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            }
            // Conte√∫do da notifica√ß√£o
            notification.innerHTML = `
                <div class="p-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            ${iconHtml}
                        </div>
                        <div class="ml-3 w-0 flex-1 pt-0.5">
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${title}</p>
                            <p class="mt-1 text-sm text-gray-500 dark:text-gray-300">${message}</p>
                        </div>
                        <div class="ml-4 flex-shrink-0 flex">
                            <button id="close-${notificationId}" class="bg-white dark:bg-slate-700 rounded-md inline-flex text-gray-400 hover:text-gray-500 dark:text-gray-300 dark:hover:text-gray-200 focus:outline-none">
                                <span class="sr-only">Fechar</span>
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            // Adicionar notifica√ß√£o ao container
            container.appendChild(notification);
            // For√ßar reflow para anima√ß√£o
            notification.offsetHeight;
            // Mostrar notifica√ß√£o com anima√ß√£o
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            // Adicionar evento de fechamento
            const closeBtn = document.getElementById(`close-${notificationId}`);
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    hideNotification(notificationId);
                });
            }
            // Remover automaticamente ap√≥s o tempo especificado
            if (duration > 0) {
                setTimeout(() => {
                    hideNotification(notificationId);
                }, duration);
            }
            return notificationId;
        }
        /**
         * Esconde uma notifica√ß√£o espec√≠fica
         * @param {string} notificationId - ID da notifica√ß√£o a ser escondida
         */
        function hideNotification(notificationId) {
            const notification = document.getElementById(notificationId);
            if (notification) {
                notification.classList.add('hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }
        /**
         * Mostra uma notifica√ß√£o de sucesso
         * @param {string} title - T√≠tulo da notifica√ß√£o
         * @param {string} message - Mensagem da notifica√ß√£o
         * @param {number} duration - Dura√ß√£o em milissegundos (padr√£o: 5000)
         */
        function showSuccessNotification(title, message, duration = 5000) {
            return showNotification('success', title, message, duration);
        }
        /**
         * Mostra uma notifica√ß√£o de aviso
         * @param {string} title - T√≠tulo da notifica√ß√£o
         * @param {string} message - Mensagem da notifica√ß√£o
         * @param {number} duration - Dura√ß√£o em milissegundos (padr√£o: 5000)
         */
        function showWarningNotification(title, message, duration = 5000) {
            return showNotification('warning', title, message, duration);
        }
        /**
         * Mostra uma notifica√ß√£o de erro
         * @param {string} title - T√≠tulo da notifica√ß√£o
         * @param {string} message - Mensagem da notifica√ß√£o
         * @param {number} duration - Dura√ß√£o em milissegundos (padr√£o: 5000)
         */
        function showErrorNotification(title, message, duration = 5000) {
            return showNotification('error', title, message, duration);
        }
        /**
         * Mostra uma notifica√ß√£o de informa√ß√£o
         * @param {string} title - T√≠tulo da notifica√ß√£o
         * @param {string} message - Mensagem da notifica√ß√£o
         * @param {number} duration - Dura√ß√£o em milissegundos (padr√£o: 5000)
         */
        function showInfoNotification(title, message, duration = 5000) {
            return showNotification('info', title, message, duration);
        }
        /**
         * Verifica condi√ß√µes para notifica√ß√µes autom√°ticas
         * @param {object} kpis - KPIs atuais
         */
        function checkAutomaticNotifications(kpis) {
            if (!kpis) return;
            const totalEnergy = kpis.total_energy || 0;
            const peakPower = kpis.peak_power || 0;
            const socInitial = kpis.soc_initial;
            const socFinal = kpis.soc_final;
            // Notifica√ß√£o de produ√ß√£o excelente
            if (totalEnergy > 30) {
                showSuccessNotification(
                    'Excelente Produ√ß√£o!',
                    `Hoje produziu ${totalEnergy} kWh - acima da m√©dia!`,
                    8000
                );
            }
            // Notifica√ß√£o de produ√ß√£o baixa
            else if (totalEnergy < 5 && totalEnergy > 0) {
                showWarningNotification(
                    'Produ√ß√£o Baixa',
                    `A produ√ß√£o de energia foi apenas ${totalEnergy} kWh hoje.`,
                    8000
                );
            }
            // Notifica√ß√£o de bateria baixa
            if (socFinal !== null && socFinal < 20) {
                showWarningNotification(
                    'Bateria Baixa',
                    `A bateria est√° com apenas ${socFinal}% de carga.`,
                    10000
                );
            }
            // Notifica√ß√£o de bateria cheia
            else if (socFinal !== null && socFinal > 95) {
                showSuccessNotification(
                    'Bateria Cheia',
                    `A bateria est√° com ${socFinal}% de carga - √≥timo estado!`,
                    6000
                );
            }
            // Notifica√ß√£o de pico solar alto
            if (peakPower > 5000) {
                showSuccessNotification(
                    'Pico Solar Excelente!',
                    `Pico de gera√ß√£o alcan√ßou ${peakPower} W - impressionante!`,
                    7000
                );
            }
        }
    </script>
{% endblock %}